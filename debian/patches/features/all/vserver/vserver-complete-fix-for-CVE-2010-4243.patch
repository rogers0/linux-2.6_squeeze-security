From: Ben Hutchings <ben@decadent.org.uk>
Subject: [PATCH] vserver: Complete fix for CVE-2010-4243

VServer requires all adjustments to mm_struct::total_vm to be
accounted to the server as well.

Signed-off-by: Ben Hutchings <ben@decadent.org.uk>
---
--- a/fs/exec.c
+++ b/fs/exec.c
@@ -169,7 +169,7 @@
 		return;
 
 	down_write(&mm->mmap_sem);
-	mm->total_vm += diff;
+	vx_vmpages_add(mm, diff);
 	up_write(&mm->mmap_sem);
 }
 
